# name: test/sql/alter/rename_table_within_transaction.test
# description: Test renaming tables in DuckLake within a transaction
# group: [alter]

require ducklake

require parquet

test-env DUCKLAKE_CONNECTION __TEST_DIR__/{UUID}.db

test-env DATA_PATH __TEST_DIR__

statement ok
ATTACH 'ducklake:${DUCKLAKE_CONNECTION}' AS ducklake (DATA_PATH '${DATA_PATH}/ducklake_rename_files', METADATA_CATALOG 'ducklake_meta', CATALOG 'test')

statement ok
use ducklake;

statement ok
CREATE TABLE tbl(i INTEGER);

statement ok
INSERT INTO tbl VALUES (999), (100);

statement ok
BEGIN TRANSACTION

statement ok
ALTER TABLE tbl RENAME TO tbl2

statement error
SELECT * FROM tbl
----

query I
SELECT * FROM tbl2
----
999
100


statement ok
COMMIT;