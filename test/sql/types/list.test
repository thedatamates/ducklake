# name: test/sql/types/list.test
# description: test storing list types in ducklake
# group: [types]

require ducklake

require parquet

test-env DUCKLAKE_CONNECTION __TEST_DIR__/{UUID}.db

test-env DATA_PATH __TEST_DIR__


statement ok
ATTACH 'ducklake:${DUCKLAKE_CONNECTION}' AS ducklake (DATA_PATH '${DATA_PATH}/ducklake_list_files', CATALOG 'test', CREATE_IF_NOT_EXISTS true);

statement ok
CREATE TABLE ducklake.test(l INTEGER[]);

query I
SELECT * FROM ducklake.test
----

statement ok
INSERT INTO ducklake.test VALUES ([1]), ([NULL]), (NULL), ([3]);

query I
SELECT * FROM ducklake.test
----
[1]
[NULL]
NULL
[3]

query I
SELECT * FROM ducklake.test WHERE l[1]=1
----
[1]

query I
SELECT * FROM ducklake.test WHERE l[1]=100
----

statement ok
INSERT INTO ducklake.test VALUES ([4, 5]), ([6, 7]);

query I
SELECT * FROM ducklake.test
----
[1]
[NULL]
NULL
[3]
[4, 5]
[6, 7]

# stats
query I
SELECT stats(l[1]) FROM ducklake.test LIMIT 1
----
<REGEX>:.*Min.*1.*Max.*7.*Has Null.*true.*
