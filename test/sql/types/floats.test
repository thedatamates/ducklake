# name: test/sql/types/floats.test
# description: test ducklake floats
# group: [types]

require ducklake

require parquet

test-env DUCKLAKE_CONNECTION __TEST_DIR__/{UUID}.db

test-env DATA_PATH __TEST_DIR__


statement ok
ATTACH 'ducklake:${DUCKLAKE_CONNECTION}' AS ducklake (DATA_PATH '${DATA_PATH}/ducklake_float_files', CATALOG 'test', CREATE_IF_NOT_EXISTS true);

foreach type FLOAT DOUBLE

statement ok
CREATE OR REPLACE TABLE ducklake.test(f ${type});

statement ok
INSERT INTO ducklake.test VALUES (1), (10);

statement ok
INSERT INTO ducklake.test VALUES ('NaN'), (1);

# predicate on NaN
query I
SELECT COUNT(*) FROM ducklake.test WHERE f='NaN'
----
1

query I
SELECT COUNT(*) FROM ducklake.test WHERE f>'NaN'
----
0

query I
SELECT COUNT(*) FROM ducklake.test WHERE f>='NaN'
----
1

query I
SELECT COUNT(*) FROM ducklake.test WHERE f<'NaN'
----
3

query I
SELECT COUNT(*) FROM ducklake.test WHERE f<='NaN'
----
4

# upper-bound requires NaN checks
query I
SELECT COUNT(*) FROM ducklake.test WHERE f>1
----
2

# test infinite
statement ok
INSERT INTO ducklake.test VALUES ('inf');

statement ok
INSERT INTO ducklake.test VALUES ('-inf');

query I
SELECT COUNT(*) FROM ducklake.test WHERE f>'inf'
----
1

query I
SELECT COUNT(*) FROM ducklake.test WHERE f>='inf'
----
2

query I
SELECT COUNT(*) FROM ducklake.test WHERE f<'inf'
----
4

query I
SELECT COUNT(*) FROM ducklake.test WHERE f<='inf'
----
5

query I
SELECT COUNT(*) FROM ducklake.test WHERE f>'-inf'
----
5

query I
SELECT COUNT(*) FROM ducklake.test WHERE f>='-inf'
----
6

endloop
