# name: test/sql/settings/parquet_row_group_size_bytes.test
# description: Test parquet row group size bytes
# group: [settings]

require ducklake

require parquet

test-env DUCKLAKE_CONNECTION __TEST_DIR__/{UUID}.db

test-env DATA_PATH __TEST_DIR__


statement ok
ATTACH 'ducklake:${DUCKLAKE_CONNECTION}' AS ducklake (DATA_PATH '${DATA_PATH}/ducklake_parquet_row_group_size_bytes', CATALOG 'test')

statement ok
CALL ducklake.set_option('parquet_row_group_size_bytes', '10KB')

statement ok
SET threads=1

# FIXME: this should not be necessary
statement ok
SET preserve_insertion_order=false;

statement ok
CREATE TABLE ducklake.tbl AS SELECT i, 'hello world' || i str FROM range(100000) t(i)

query I
SELECT COUNT(DISTINCT row_group_id)>10 FROM parquet_metadata('${DATA_PATH}/ducklake_parquet_row_group_size_bytes/**')
----
true

query II
SELECT value, scope FROM ducklake.options() WHERE option_name='parquet_row_group_size_bytes'
----
10000	GLOBAL
