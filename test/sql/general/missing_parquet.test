# name: test/sql/general/missing_parquet.test
# description: Test with missing parquet extension
# group: [general]

require ducklake

require no_extension_autoloading "EXPECTED This is meant to test missing parquet extension"

test-env DUCKLAKE_CONNECTION __TEST_DIR__/{UUID}.db

statement ok
ATTACH 'ducklake:${DUCKLAKE_CONNECTION}' AS ducklake (DATA_PATH '__TEST_DIR__/ducklake_missing_parquet', CATALOG 'test')

statement ok
SELECT snapshot_id, schema_version, changes FROM ducklake_snapshots('ducklake')

statement error
CREATE TABLE ducklake.tbl AS FROM range(1000) t(i);
----
Missing Extension Error: Could not load the copy function for "parquet". Try explicitly loading the "parquet" extension

require parquet

statement ok
CREATE TABLE ducklake.tbl AS FROM range(1000) t(i);
