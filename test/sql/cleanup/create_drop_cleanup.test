# name: test/sql/cleanup/create_drop_cleanup.test
# description: Cleanup files when creating and dropping a table
# group: [cleanup]

require ducklake

require parquet

test-env DUCKLAKE_CONNECTION __TEST_DIR__/{UUID}.db

test-env DATA_PATH __TEST_DIR__


statement ok
ATTACH 'ducklake:${DUCKLAKE_CONNECTION}' AS ducklake (DATA_PATH '${DATA_PATH}/ducklake_createq_drop_cleanup', CATALOG 'test')

statement ok
BEGIN

statement ok
CREATE TABLE ducklake.tbl(i INT);

statement ok
INSERT INTO ducklake.tbl VALUES (42);

query I
SELECT COUNT(*) FROM glob('${DATA_PATH}/ducklake_createq_drop_cleanup/test/main/tbl/*.parquet')
----
1

statement ok
DROP TABLE ducklake.tbl

query I
SELECT COUNT(*) FROM glob('${DATA_PATH}/ducklake_createq_drop_cleanup/test/main/tbl/*.parquet')
----
0

statement ok
COMMIT

